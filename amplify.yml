version: 1
frontend:
  phases:
    preBuild:
      commands:
        - yum install -y jq
        - yarn install
    build:
      commands:
        - export GATSBY_ALGOLIA_APP_ID=$(aws secretsmanager get-secret-value --secret-id ${BUILD_SECRETS_MANAGER_KEY_ID} |jq -r ".SecretString" |jq .ALGOLIA_APPLICATION_ID)
        - export ALGOLIA_ADMIN_KEY=$(aws secretsmanager get-secret-value --secret-id ${BUILD_SECRETS_MANAGER_KEY_ID} |jq -r ".SecretString" |jq .ALGOLIA_ADMIN_API_KEY)
        - yarn run build
  artifacts:
    baseDirectory: public
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
